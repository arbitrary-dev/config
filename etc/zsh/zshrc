# The following lines were added by compinstall

zstyle ':completion:*' completer _complete _ignored _approximate
zstyle ':completion:*' expand prefix suffix
zstyle ':completion:*' list-suffixes true
zstyle ':completion:*' matcher-list 'r:|[._-]=** r:|=**'
zstyle ':completion:*' max-errors 4
zstyle ':completion:*' original false
zstyle ':completion:*' preserve-prefix '//[^/]##/'

autoload -Uz compinit
compinit
# End of lines added by compinstall
# Lines configured by zsh-newuser-install
HISTFILE=~/.zhistory
HISTSIZE=1000
SAVEHIST=1000
setopt appendhistory autocd
unsetopt beep extendedglob nomatch notify
bindkey -v
# End of lines configured by zsh-newuser-install

export EDITOR=vim

# history lookup using prefixes
bindkey "^[[A" history-beginning-search-backward
bindkey "^[[B" history-beginning-search-forward

# aliases

alias -s mp4=mpv
alias -s MPG=mpv
alias -s avi=mpv
alias -s mkv=mpv
alias -s flv=mpv
alias -s webm="mpv -loop-playlist=inf"
alias -s pdf=mupdf-x11
alias -s txt=vim
alias -s md=vim
alias -s png="feh -F"
alias -s jpg="feh -F"

alias xc='xclip -i -selection clipboard'
alias xp='xclip -o -selection clipboard'

alias vr="vim ~/.zshrc"
sr() { source /etc/zsh/zshrc; source ~/.zshrc; }

alias pr=perl-rename
alias cl=clear
alias sed="sed -r"
alias less="less -iSXFR"

# utilities

x() { sed -n $1p $2; }
esc=$(printf '\033')
alias shorten-paths='sed -e "s|/.+/([^/]+/)|/**/\1|"'

# GIT shortcuts

alias git-reset-tree="git read-tree --reset -u HEAD"
alias git-fix-owner="cd /; git ls-tree -r HEAD home/semyon --name-only | xargs chown semyon"

gst() {
  git status --short | \
  shorten-paths | \
  sed -e "s/^(.)(.)/${esc}[32m\1${esc}[0m${esc}[31m\2${esc}[0m/"
}

grr() {
  git branch -r | \
  sed -e "/$MY_NAME|((master|develop)$)/d" | \
  xargs -L1 git branch -rd
}

gbl() {
  local out=$(git blame --abbrev=6 -s -L ${@:1})
  local n=$( \
    echo $out | \
    sed -ne "s/[^)]*) ( *)[^ ].*/\1/p" | \
    awk '{print length}' | \
    sort -g | \
    head -n1
  )

  echo $out | \
  sed -e "s_^([0-9a-z]+) ([0-9]+)) ( {0,$n})_${esc}[32m\1 ${esc}[34m\2${esc}[0m _" | \
  less -iSXFR
}

alias ga="git add"
alias gb="git branch"
alias gco="git co"
alias gcp="git cp"
alias grst="git reset"
alias gt="git tag"
alias gbs="git branch -a --format='%(refname:short) %(color:red)%(authordate:relative)' --list *$MY_NAME*"
alias gbi="git bisect"
alias gls="git ls"

alias gp="git push"
alias gf="git fetch"
alias gpl="git pull"

alias gs="git show"
gsno() { git show-no $1 | shorten-paths; }

alias gsh="git stash save"
alias gsha="git stash apply"
alias gshs="git stash show -p"
alias gshl="git stash list"
alias gshp="git stash pop"
alias gshd="git stash drop"

alias gdf="git df"
gdfno() { git df --name-only $1 $2 | shorten-paths; }
gdfno1() { git df --name-only $1{^,} | shorten-paths; }
alias gdfc="git dfc"

alias glg="git lg"
alias glgo="git lgo"
alias glg10="git lg -10"
alias glgo10="git lgo -10"

alias gc="git commit"
alias gcf="git cf"
alias gcaf="git caf"
alias gcm="git cm"
alias gcam="git cam"

alias gr="git rebase"
alias gri="git ri"
alias grc="git rc"
alias gra="git rebase --abort"

alias gm="git merge"
alias gmff="git merge --ff-only"
alias gma="git merge --abort"
alias gmt="git mergetool"
